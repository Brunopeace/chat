<!DOCTYPE html>
<html>
<head>
  <title>Chat com PeerJS</title>
  <style>
    body { font: 14px sans-serif; }
    #messages { list-style-type: none; padding: 0; }
    #messages li { padding: 8px; margin-bottom: 4px; border-radius: 4px; }
    #messages .sent { background-color: #e3f2fd; } /* Light blue for sent messages */
    #messages .received { background-color: #f0f0f0; } /* Light gray for received messages */
    #form { display: flex; }
    #input { flex: 1; padding: 10px; font-size: 14px; }
    #sendButton { padding: 10px; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Chat com PeerJS</h1>
  <div>
    Seu ID: <input id="your-id" value="meu-id-fixo" />
    <button id="connect-my-peer">Usar ID Fixo</button>
  </div>
  <div>
    Conectar ao ID: <input id="peer-id-input" /><button id="connect-button">Connect</button>
  </div>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="input" autocomplete="off" /><button id="sendButton">Send</button>
  </form>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.3.2/peerjs.min.js"></script>
  <script>
    let peer;
    let conn;

    // Carregar o ID fixo do localStorage, se dispon√≠vel
    const storedId = localStorage.getItem('peer-id');
    if (storedId) {
      document.getElementById('your-id').value = storedId;
      initializePeer(storedId);
    }

    document.getElementById('connect-my-peer').addEventListener('click', function() {
      const fixedId = document.getElementById('your-id').value;
      // Salvar o ID fixo no localStorage
      localStorage.setItem('peer-id', fixedId);
      initializePeer(fixedId);
    });

    document.getElementById('connect-button').addEventListener('click', function() {
      const peerId = document.getElementById('peer-id-input').value;
      conn = peer.connect(peerId);

      conn.on('open', function() {
        conn.on('data', function(data) {
          addMessage(data, 'received'); // Marking messages as received
        });

        document.getElementById('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const input = document.getElementById('input');
          if (input.value) {
            conn.send(input.value);
            addMessage(input.value, 'sent'); // Marking messages as sent
            input.value = '';
          }
        });
      });
    });

    function initializePeer(id) {
      if (peer) {
        peer.destroy(); // Destruir o peer existente, se houver
      }
      peer = new Peer(id);

      peer.on('open', function(id) {
        document.getElementById('your-id').value = id;
      });

      peer.on('connection', function(connection) {
        conn = connection;
        conn.on('data', function(data) {
          addMessage(data, 'received'); // Marking messages as received
        });

        document.getElementById('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const input = document.getElementById('input');
          if (input.value) {
            conn.send(input.value);
            addMessage(input.value, 'sent'); // Marking messages as sent
            input.value = '';
          }
        });
      });
    }

    function addMessage(message, type) {
      const item = document.createElement('li');
      item.textContent = message;
      item.classList.add(type); // Add a class to differentiate sent vs received messages
      document.getElementById('messages').appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>
</html>