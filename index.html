<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeerJS Chat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f2f2f2;
    }

    header {
      background-color: #4CAF50;
      color: white;
      text-align: center;
      padding: 10px 0;
    }

    .container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap; /* Permitir que os itens do container se ajustem em linhas */
      max-width: 800px;
      margin: 20px auto;
    }

    .container section {
      flex: 1 1 100%; /* Ocupar todo o espaço disponível */
      margin: 0 10px;
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .container h2 {
      color: #333;
    }

    .input-group {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    .input-group input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .input-group button {
      padding: 10px 20px;
      font-size: 14px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    main {
      max-width: 800px;
      margin: 20px auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #messages {
      list-style-type: none;
      padding: 0;
      margin-bottom: 20px;
    }

    #messages li {
      padding: 8px;
      margin-bottom: 4px;
      border-radius: 4px;
    }

    #messages .sent {
      background-color: #e3f2fd;
    }

    #messages .received {
      background-color: #f0f0f0;
    }

    #form {
      display: flex;
      align-items: center;
      background-color: #fff;
      padding: 10px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    #input {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px 0 0 4px;
    }

    #sendButton {
      padding: 10px 20px;
      font-size: 14px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 0 4px 4px 0;
    }

    @media (max-width: 600px) {
      .container {
        flex-direction: column; /* Empilhar os itens verticalmente em telas menores */
      }

      .container section {
        margin-bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>PeerJS Chat</h1>
  </header>
  
  <div class="container">
    <section id="self-info">
      <h2>Seu ID:</h2>
      <div class="input-group">
        <input id="your-id" type="text" value="meu-id-fixo" disabled>
        <button id="connect-my-peer">Usar ID Fixo</button>
      </div>
    </section>

    <section id="connect-peer">
      <h2>Conectar ao ID:</h2>
      <div class="input-group">
        <input id="peer-id-input" type="text" placeholder="Insira o ID do peer">
        <button id="connect-button">Conectar</button>
      </div>
    </section>
  </div>

  <main>
    <ul id="messages"></ul>

    <form id="form" action="">
      <input id="input" type="text" autocomplete="off" placeholder="Digite sua mensagem...">
      <button id="sendButton">Enviar</button>
    </form>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.3.2/peerjs.min.js"></script>
  <script>
    let peer;
    let conn;

    // Carregar o ID fixo do localStorage, se disponível
    const storedId = localStorage.getItem('peer-id');
    if (storedId) {
      document.getElementById('your-id').value = storedId;
      initializePeer(storedId);
    }

    document.getElementById('connect-my-peer').addEventListener('click', function() {
      const fixedId = document.getElementById('your-id').value;
      // Salvar o ID fixo no localStorage
      localStorage.setItem('peer-id', fixedId);
      initializePeer(fixedId);
    });

    document.getElementById('connect-button').addEventListener('click', function() {
      const peerId = document.getElementById('peer-id-input').value;
      conn = peer.connect(peerId);

      conn.on('open', function() {
        conn.on('data', function(data) {
          addMessage(data, 'received'); // Marking messages as received
        });

        document.getElementById('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const input = document.getElementById('input');
          if (input.value) {
            conn.send(input.value);
            addMessage(input.value, 'sent'); // Marking messages as sent
            input.value = '';
          }
        });
      });
    });

    function initializePeer(id) {
      if (peer) {
        peer.destroy(); // Destruir o peer existente, se houver
      }
      peer = new Peer(id);

      peer.on('open', function(id) {
        document.getElementById('your-id').value = id;
      });

      peer.on('connection', function(connection) {
        conn = connection;
        conn.on('data', function(data) {
          addMessage(data, 'received'); // Marking messages as received
        });

        document.getElementById('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const input = document.getElementById('input');
          if (input.value) {
            conn.send(input.value);
            addMessage(input.value, 'sent'); // Marking messages as sent
            input.value = '';
          }
        });
      });
    }

    function addMessage(message, type) {
      const item = document.createElement('li');
      item.textContent = message;
      item.classList.add(type); // Add a class to differentiate sent vs received messages
      document.getElementById('messages').appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>
</html>